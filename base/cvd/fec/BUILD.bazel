package(
    default_visibility = ["//:android_cuttlefish"],
)

cc_binary(
    name = "fec",
    srcs = [
        "ext4_utils/ext4_sb.cpp",
        "ext4_utils/include/ext4_utils/ext4_extents.h",
        "ext4_utils/include/ext4_utils/ext4.h",
        "ext4_utils/include/ext4_utils/ext4_kernel_headers.h",
        "ext4_utils/include/ext4_utils/ext4_sb.h",
        "ext4_utils/include/ext4_utils/jbd2.h",
        "ext4_utils/include/ext4_utils/xattr.h",
        "libfec/avb_utils.cpp",
        "libfec/avb_utils.h",
        "libfec/fec_open.cpp",
        "libfec/fec_private.h",
        "libfec/fec_process.cpp",
        "libfec/fec_read.cpp",
        "libfec/fec_verity.cpp",
        "libfec/include/fec/ecc.h",
        "libfec/include/fec/io.h",
        "libcrypto_utils/include/crypto_utils/android_pubkey.h",
        "libutils/include/utils/Compat.h",
        "squashfs_utils/squashfs_utils.h",
        "verity/fec/image.cpp",
        "verity/fec/image.h",
        "verity/fec/main.cpp",
    ],
    includes = [
        "ext4_utils/include",
        "libcrypto_utils/include",
        "libfec/include",
        "libutils/include",
        "squashfs_utils",
    ],
    copts = [
        "-DFEC_NO_KLOG",
        "-DNDEBUG",
        "-Wno-private-header",
        "-Wno-vla-cxx-extension",
    ],
    deps = [
        "@avb//:libavb",
        "@boringssl//:crypto",
        "@fec_rs//:libfec_rs",
        "//libbase",
        "//libsparse",
    ],
)
